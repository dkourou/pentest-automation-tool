#!/usr/bin/env bash

#
# Returns system user name to run in rootful mode
#
get_user_name() {
  echo "${VENDOR_CODE}-${BOX}${PROJECT_SUFFIX}-srv"
}

#
# calculate base target dir
#
get_service_base_dir() {
  local base_dir_var_name base_dir_provided
  base_dir_var_name="${SERVICE_ENVVAR_PREFIX}_BASE_DIR"

  printf -v base_dir_provided '%s' "${!base_dir_var_name}"
  if [ -n "${base_dir_provided}" ]; then
    echo "${base_dir_provided}"
    return 0
  fi

  if [ "${EUID}" == 0 ] || [ "$(whoami)" == "$(get_user_name)" ]; then
    echo "/opt/${SERVICE_NAME}"
    return 0
  fi

  local user_home_dir
  user_home_dir=$(getent passwd "$USER" | cut -d: -f6)
  echo "${user_home_dir}/${SERVICE_NAME}"
}
